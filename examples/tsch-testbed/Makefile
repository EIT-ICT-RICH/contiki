
TARGET ?= sky
CONTIKI_WITH_RPL = 0

APP_NO_RPL_UNICAST=1
APP_RPL_COLLECT_ONLY=2
APP_LINK_PROBE=3

ifeq ($(APP),APP_LINK_PROBE)
APP=$(APP_LINK_PROBE)
CONTIKI_PROJECT = app-link-probing
else
	ifeq ($(APP),APP_NO_RPL_UNICAST)
	APP=$(APP_NO_RPL_UNICAST)
	CONTIKI_PROJECT = app-no-rpl-unicast
	else
		ifeq ($(APP),APP_RPL_COLLECT_ONLY)
		APP=$(APP_RPL_COLLECT_ONLY)
		CONTIKI_PROJECT = app-rpl-collect-only
		CONTIKI_WITH_RPL = 1
		#else
		#$(error APP not set correctly.)
		endif
	endif
endif

CFLAGS += -DPROJECT_CONF_H=\"project-conf.h\"

APPS = deployment

CONFIG_NULLRDC=1
CONFIG_CONTIKIMAC=2
CONFIG_TSCH=3

DEPLOYMENT_COOJA=1
DEPLOYMENT_MOTES=2
DEPLOYMENT_TWIST=3
DEPLOYMENT_INDRIYA=4

CONFIG=$(CONFIG_TSCH)
#CONFIG=$(CONFIG_CONTIKIMAC)
#CONFIG=$(CONFIG_NULLRDC)

PANID ?= 0xABCD

CONTIKI_WITH_IPV6 = 1
CFLAGS+= -DAPP=$(APP)
CFLAGS+= -DCONTIKI_WITH_RPL=$(CONTIKI_WITH_RPL)
CFLAGS+= -DCONFIG_NULLRDC=$(CONFIG_NULLRDC)
CFLAGS+= -DCONFIG_CONTIKIMAC=$(CONFIG_CONTIKIMAC)
CFLAGS+= -DCONFIG_TSCH=$(CONFIG_TSCH)
CFLAGS+= -DCONFIG=$(CONFIG)
ifdef CMD_DEP
CFLAGS+= -DDEPLOYMENT=$(CMD_DEP)
endif
CFLAGS+= -DCMD_IEEE802154_PANID=$(PANID)

ifneq ($(CONFIG),$(CONFIG_CONTIKIMAC))
CFLAGS+= -DWITHOUT_CONTIKIMAC
endif
CFLAGS+= -DWITHOUT_COMPOWER
CFLAGS+= -DWITHOUT_6LOWPAN_ATTR
CFLAGS+= -DWITHOUT_MAC_TX_ATTR
CFLAGS+= -DWITHOUT_ATTR_TX_POWER
CFLAGS+= -DWITHOUT_ATTR_RELIABLE
CFLAGS+= -DWITHOUT_ATTR_LINK_QUALITY
CFLAGS+= -DWITHOUT_ATTR_TIMESTAMP
CFLAGS+= -DWITHOUT_ATTR_FRAME_TYPE

PROJECTDIRS += tools
PROJECT_SOURCEFILES += node-id.c
# to recompile on changes to schedules: 
PROJECT_LIBRARIES += static-schedules.h
PROJECT_SOURCEFILES += orchestra.c orchestra-sf-eb.c \
  orchestra-sf-common-shared.c orchestra-sf-rb-unicast.c \
  orchestra-sf-sb-unicast.c orchestra-sf-sb-rpl-unicast.c 

ifneq ($(TARGET),jn5168)
PROJECT_SOURCEFILES += uart1-putchar.c
endif

all: $(CONTIKI_PROJECT)

CONTIKI=../..
include $(CONTIKI)/Makefile.include

%.exe: %.sky
	cp $< $@
